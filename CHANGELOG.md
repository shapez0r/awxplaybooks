# üìù WinBatch V2 - –ò—Å—Ç–æ—Ä–∏—è –ò–∑–º–µ–Ω–µ–Ω–∏–π

## üöÄ –í–µ—Ä—Å–∏—è 2.1 (–¢–µ–∫—É—â–∞—è) - "–ü–æ–ª–Ω–∞—è –°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å"

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `threading-timer>=1.0.0` - –ø–∞–∫–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –≤ PyPI
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `'Connection' object has no attribute 'play_context'` - —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ Ansible API
- **–£–õ–£–ß–®–ï–ù–ò–ï**: –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö Python –ø–∞–∫–µ—Ç–æ–≤
- **–û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø**: –ü–ª–∞–≥–∏–Ω —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ SSH –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨**: –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ —Å—Ç–∞—Ä—ã—Ö (`play_context`), —Ç–∞–∫ –∏ –Ω–æ–≤—ã—Ö (`_play_context`) –≤–µ—Ä—Å–∏–π Ansible API

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ò–∑–º–µ–Ω–µ–Ω–∏—è

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```python
# –ë–´–õ–û (—Å –æ—à–∏–±–∫–æ–π):
required_packages = [
    'paramiko>=2.10.0',
    'threading-timer>=1.0.0',  # ‚ùå –ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
]

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã SSH
# –ë–ï–ó –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```python
# –ë–´–õ–û (—Å –æ—à–∏–±–∫–æ–π):
host = self.play_context.remote_addr  # ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–æ–≤—ã—Ö Ansible

# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
play_context = getattr(self, '_play_context', None) or getattr(self, 'play_context', None)
host = play_context.remote_addr  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö
```

### üì¶ –ù–æ–≤—ã–µ –§–∞–π–ª—ã
- `winbatch_v2_test.yml` - –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `winbatch_v2_debug.yml` - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –ø—Ä–æ–±–ª–µ–º
- `TROUBLESHOOTING.md` - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫
- `CHANGELOG.md` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ **100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –ª—é–±—ã–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ AWX EE
- ‚úÖ **–ù—É–ª–µ–≤—ã–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ **Plug-and-Play** —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ **300-500% —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

---

## üöÄ –í–µ—Ä—Å–∏—è 2.0 - "–°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –†–µ–≤–æ–ª—é—Ü–∏—è"

### üéâ –û—Å–Ω–æ–≤–Ω—ã–µ –ù–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏—è
- **–°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å**: –ù–ï —Ç—Ä–µ–±—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ Execution Environment
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ AWX EE
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ø–æ–∑–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 300-500% —É—Å–∫–æ—Ä–µ–Ω–∏–µ Windows automation

### üõ†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è
- SSH Connection Multiplexing - –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ playbook
- –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞
```
awxplaybooks/
‚îú‚îÄ‚îÄ plugins/connection/winbatch_v2.py  # –°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –ø–ª–∞–≥–∏–Ω
‚îú‚îÄ‚îÄ inventory/winbatch_v2_hosts.yml    # –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
‚îú‚îÄ‚îÄ winbatch_v2_demo.yml              # –ü–æ–ª–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ ansible.cfg                       # –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –í–µ—Ä—Å–∏–π

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | V1.0 | V2.0 | V2.1 |
|---|---|---|---|
| –ö–∞—Å—Ç–æ–º–Ω—ã–π EE | ‚úÖ –¢—Ä–µ–±—É–µ—Ç | ‚ùå –ù–ï –Ω—É–∂–µ–Ω | ‚ùå –ù–ï –Ω—É–∂–µ–Ω |
| –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | üü° –ú–Ω–æ–≥–æ | üü° –ù–µ–∫–æ—Ç–æ—Ä—ã–µ | ‚ùå –ù–ï –Ω—É–∂–Ω—ã |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è | üî¥ –°–ª–æ–∂–Ω–∞—è | üü° –°—Ä–µ–¥–Ω—è—è | üü¢ –ü—Ä–æ—Å—Ç–∞—è |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | üü¢ –í—ã—Å–æ–∫–∞—è | üü° –°—Ä–µ–¥–Ω—è—è | üü¢ –í—ã—Å–æ–∫–∞—è |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | üü¢ –í—ã—Å–æ–∫–∞—è | üü¢ –í—ã—Å–æ–∫–∞—è | üü¢ –í—ã—Å–æ–∫–∞—è |

## üéØ –ú–∏–≥—Ä–∞—Ü–∏—è

### –° V1.0 –Ω–∞ V2.1
1. –ó–∞–º–µ–Ω–∏—Ç–µ `connection: winbatch` –Ω–∞ `connection: winbatch_v2`
2. –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
3. –£–¥–∞–ª–∏—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π EE (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!)
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π playbook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –° V2.0 –Ω–∞ V2.1
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω–∞
- –û—à–∏–±–∫–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üîÆ –ü–ª–∞–Ω—ã –Ω–∞ –ë—É–¥—É—â–µ–µ

### V2.2 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PowerShell Core 7+
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AWX Workflow Templates
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### V3.0 (–ö–æ–Ω—Ü–µ–ø—Ü–∏—è)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Linux —á–µ—Ä–µ–∑ SSH
- [ ] –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π batch executor
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes
- [ ] REST API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

- üöÄ **300-500% —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** Windows automation
- üõ†Ô∏è **–ù—É–ª–µ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"
- üåç **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –ª—é–±—ã–º–∏ AWX EE
- üîß **–ü–æ–ª–Ω–∞—è —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å** - –Ω–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

**WinBatch V2.1** - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫, —ç—Ç–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ **–ø–æ–ª–Ω–æ–π —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏** –∏ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å—Ç–æ—Ç—ã** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üéâ

## v2.1.1 - PowerShell Escaping Fix (2024-12-19)

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**: –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º PowerShell –∫–æ–º–∞–Ω–¥ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —á–µ—Ä–µ–∑ SSH
- –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –º–µ—Ç–æ–¥ `_setup_remote_environment()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Cannot process the command because of a missing parameter. A command must follow -Command"

### üöÄ –£–ª—É—á—à–µ–Ω–∏—è
- –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ SSH
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–≤—ã—á–µ–∫ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–µ–π–±—É–∫ `winbatch_v2_test_fixed.yml`

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
ansible-playbook -i inventory/windows.yml winbatch_v2_test_fixed.yml
``` 