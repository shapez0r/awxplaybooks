---
# WinBatch V2 Test Playbook - Plugin Loading Fix
# Тестирует исправление проблемы с загрузкой плагина
name: "WinBatch V2 Plugin Loading Fix Test"
hosts: windows_hosts
gather_facts: false
connection: winbatch_v2

vars:
  test_session: "winbatch_v2_plugin_fix_{{ ansible_date_time.epoch }}"

tasks:
  - name: "🔧 Test 1: Basic Connection Test"
    win_shell: "Write-Host 'WinBatch V2 Plugin Loading Fix Test - Connection OK!'"
    register: test1_result

  - name: "📋 Test 2: System Information"
    win_shell: "Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion"
    register: test2_result

  - name: "🌐 Test 3: Network Test"
    win_shell: "Test-NetConnection -ComputerName google.com -Port 80 -InformationLevel Quiet"
    register: test3_result

  - name: "📁 Test 4: File System Test"
    win_shell: "Get-ChildItem C:\\ | Select-Object -First 5 Name, Mode"
    register: test4_result

  - name: "💻 Test 5: Process List"
    win_shell: "Get-Process | Select-Object -First 3 Name, CPU, WorkingSet"
    register: test5_result

  - name: "📊 Display Test Results"
    debug:
      msg: |
        🎯 WinBatch V2 Plugin Loading Fix Test Results:
        
        ✅ Test 1 (Connection): {{ 'SUCCESS' if test1_result.rc == 0 else 'FAILED' }}
        ✅ Test 2 (System Info): {{ 'SUCCESS' if test2_result.rc == 0 else 'FAILED' }}
        ✅ Test 3 (Network): {{ 'SUCCESS' if test3_result.rc == 0 else 'FAILED' }}
        ✅ Test 4 (File System): {{ 'SUCCESS' if test4_result.rc == 0 else 'FAILED' }}
        ✅ Test 5 (Processes): {{ 'SUCCESS' if test5_result.rc == 0 else 'FAILED' }}
        
        🚀 Plugin Loading Issue Fixed!
        ❌ No more warnings about winbatch_module_parser.py
        ✅ WinBatch V2 Connection Plugin working correctly! 