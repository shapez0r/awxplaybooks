---
# WinBatch V2 Test Playbook - Plugin Loading Fix
# Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¾Ğ¹ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ°
name: "WinBatch V2 Plugin Loading Fix Test"
hosts: windows_hosts
gather_facts: false
connection: winbatch_v2

vars:
  test_session: "winbatch_v2_plugin_fix_{{ ansible_date_time.epoch }}"

tasks:
  - name: "ğŸ”§ Test 1: Basic Connection Test"
    win_shell: "Write-Host 'WinBatch V2 Plugin Loading Fix Test - Connection OK!'"
    register: test1_result

  - name: "ğŸ“‹ Test 2: System Information"
    win_shell: "Get-ComputerInfo | Select-Object WindowsProductName, WindowsVersion"
    register: test2_result

  - name: "ğŸŒ Test 3: Network Test"
    win_shell: "Test-NetConnection -ComputerName google.com -Port 80 -InformationLevel Quiet"
    register: test3_result

  - name: "ğŸ“ Test 4: File System Test"
    win_shell: "Get-ChildItem C:\\ | Select-Object -First 5 Name, Mode"
    register: test4_result

  - name: "ğŸ’» Test 5: Process List"
    win_shell: "Get-Process | Select-Object -First 3 Name, CPU, WorkingSet"
    register: test5_result

  - name: "ğŸ“Š Display Test Results"
    debug:
      msg: |
        ğŸ¯ WinBatch V2 Plugin Loading Fix Test Results:
        
        âœ… Test 1 (Connection): {{ 'SUCCESS' if test1_result.rc == 0 else 'FAILED' }}
        âœ… Test 2 (System Info): {{ 'SUCCESS' if test2_result.rc == 0 else 'FAILED' }}
        âœ… Test 3 (Network): {{ 'SUCCESS' if test3_result.rc == 0 else 'FAILED' }}
        âœ… Test 4 (File System): {{ 'SUCCESS' if test4_result.rc == 0 else 'FAILED' }}
        âœ… Test 5 (Processes): {{ 'SUCCESS' if test5_result.rc == 0 else 'FAILED' }}
        
        ğŸš€ Plugin Loading Issue Fixed!
        âŒ No more warnings about winbatch_module_parser.py
        âœ… WinBatch V2 Connection Plugin working correctly! 