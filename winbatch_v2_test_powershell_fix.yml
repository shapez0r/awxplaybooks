---
# WinBatch V2 Test Playbook - PowerShell Command Fix
# Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ PowerShell ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°Ğ¼Ğ¸
name: "WinBatch V2 PowerShell Command Fix Test"
hosts: windows_hosts
gather_facts: false
connection: winbatch_v2

vars:
  test_session: "winbatch_v2_ps_fix_{{ ansible_date_time.epoch }}"

tasks:
  - name: "ğŸ”§ Test 1: Simple PowerShell Command"
    win_shell: "Write-Host 'PowerShell Command Fix Test - SUCCESS!'"
    register: test1_result

  - name: "ğŸ“‹ Test 2: Get Computer Name"
    win_shell: "hostname"
    register: test2_result

  - name: "ğŸ•’ Test 3: Get Current Date"
    win_shell: "Get-Date -Format 'yyyy-MM-dd HH:mm:ss'"
    register: test3_result

  - name: "ğŸ“ Test 4: List C: Drive Contents"
    win_shell: "Get-ChildItem C:\\ | Select-Object -First 3 Name"
    register: test4_result

  - name: "ğŸ’» Test 5: Get System Info"
    win_shell: "Get-WmiObject -Class Win32_OperatingSystem | Select-Object Caption, Version"
    register: test5_result

  - name: "ğŸŒ Test 6: Network Interface"
    win_shell: "Get-NetAdapter | Select-Object -First 1 Name, Status"
    register: test6_result

  - name: "ğŸ“Š Display Test Results"
    debug:
      msg: |
        ğŸ¯ WinBatch V2 PowerShell Command Fix Test Results:
        
        âœ… Test 1 (Simple Command): {{ 'SUCCESS' if test1_result.rc == 0 else 'FAILED' }}
        âœ… Test 2 (Hostname): {{ test2_result.stdout.strip() if test2_result.rc == 0 else 'FAILED' }}
        âœ… Test 3 (Date): {{ test3_result.stdout.strip() if test3_result.rc == 0 else 'FAILED' }}
        âœ… Test 4 (File List): {{ 'SUCCESS' if test4_result.rc == 0 else 'FAILED' }}
        âœ… Test 5 (System Info): {{ 'SUCCESS' if test5_result.rc == 0 else 'FAILED' }}
        âœ… Test 6 (Network): {{ 'SUCCESS' if test6_result.rc == 0 else 'FAILED' }}
        
        ğŸš€ PowerShell Command Escaping Issue Fixed!
        âœ… No more "ScriptBlock should only be specified as a value of the Command parameter" errors
        âœ… WinBatch V2 PowerShell execution working correctly! 